# This is a common .travis.yml for generating library release zip files for
# CircuitPython library releases using circuitpython-build-tools.
# See https://github.com/adafruit/circuitpython-build-tools for detailed setup
# instructions.

dist: xenial
language: python
python:
  - "3.6"

cache:
  pip: true

env:
  - DEPLOY_PYPI="true"

deploy:
  - provider: releases
    api_key: "$GITHUB_TOKEN"
    file_glob: true
    file: "$TRAVIS_BUILD_DIR/bundles/*"
    skip_cleanup: true
    overwrite: true
    on:
      tags: true

  - provider: pypi
    user: adafruit-travis
    password:
      secure: 2PQ1bQpvgzZtRPrrNOMRatxyMDky6h/KE32pxI/vp4wV+S3blefcRZOVUDAfH1PUfnqJD+D4p1wKYGGu86upsQRi0Pc4mam99YQscvV0O5PG0682o+22MU3z0zFRT1rPTXuBNQGY+T/0jwkk7+F4ZfriTfKuB5DzpZZQ4mJ1V1C005qFpKsWIIc9O+K8hbroFm+e6cMVa8NBGW8t13XLG3k/JqWFj3zqwSBVCwb/ti6+7k1XFxwrsa0B9XuBuNRXkhmrQvoeaARMrUAU9hWvWDlEdekglY+5H6o4gCkhsOBwLDmDq1f3AzjJHK8aXM2L6lZLBwOAdjhk2ZYojXQlZ4LRdia2ZLHJmdCSv2k43uwkOV4HfTmCSgIPi2vWPC9aTXd2jqRUB51i6ndNhx8MWHVRhpxmbCD0m6TfwncJiJNApkAhK+BTQbafA2esSHJjuoogB0guZpuSsZoV0aBm7if+Pg7kfHxKOLXrqskJxohSjG5D3LAvcjsgW7ITh8S+xlkpKtKP0GLKeKTkqNNPtYT3aFbwO9zSyErqwG21bQwAv4covLSqsJdx+Uo/kFS86WJR4kWfD3fFm0JI9H9aCiWWxY75FxeAhsHAQ17W5SvotX+EJWGpUx1CBB/9k2cv1Ch6m1P6yv4XzaYTYLvIWFe30h0opdQo8kKSjj7pfXw=
    on:
      tags: true
      condition: $DEPLOY_PYPI = "true"

install:
  - pip install -r requirements.txt
  - pip install circuitpython-build-tools Sphinx sphinx-rtd-theme
  - pip install --force-reinstall pylint==1.9.2

script:
  - pylint adafruit_ssd1305.py
  - ([[ ! -d "examples" ]] || pylint --disable=missing-docstring,invalid-name,bad-whitespace examples/*.py)
  - circuitpython-build-bundles --filename_prefix adafruit-circuitpython-ssd1305 --library_location .
  - cd docs && sphinx-build -E -W -b html . _build/html && cd ..
